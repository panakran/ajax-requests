<!DOCTYPE html>
<html>
    <head>
        <title>Ajax-requests</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!--<link rel='shortcut icon' type='image/x-icon' href='./favicon.ico' />-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <!--<link rel="stylesheet" href="./node_modules/materialize-css/dist/css/materialize.css">-->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <!-- Compiled and minified JavaScript -->

        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
        <!--<script src="./node_modules/materialize-css/dist/js/materialize.js"></script>-->
        <!--<script src="./node_modules/axios/dist/axios.js"></script>-->
        <style>    
            .leftpadding{padding-left:15px;}
        </style>    
    </head>
    <body>
        <nav>
            <div class="nav-wrapper blue leftpadding">
                <a class="brand-logo">Test CORS requests locally</a>
                <ul id="nav-mobile" class="right hide-on-med-and-down">
                    <li><a href="https://github.com/panakran/ajax-requests"><strong>Github</strong></a></li>
                    <!--                    <li><a href="badges.html">Components</a></li>
                                        <li><a href="collapsible.html">JavaScript</a></li>-->
                </ul>
            </div>
        </nav>
        <div class="progress" >
            <div id="progressbar" class="determinate" style="width: 0%"></div>
        </div>
        <div class="row">
            <div class="col s6">
                <h4>Request
                </h4>
                <div class="input-field col s12">
                    <select class="icons" id="methods">
                        <option value="" disabled selected>Please choose an method</option>
                        <option value="">GET</option>
                        <option value="">POST</option>
                        <option value="">PUT</option>
                        <option value="">DELETE</option>
                    </select>
                    <label for="methods">Method</label>
                </div>
                <div class="input-field col s12">
                    <input id="baseurl" type="text">
                    <label for="baseurl">Base url</label>
                </div>
                <div class="input-field col s12">
                    <input id="url" type="text"/>
                    <label for="url">Base url</label>
                </div>
                <div class="input-field col s12">
                    <textarea id="headers" class="materialize-textarea headers"></textarea>
                    <label for="headers">Headers</label>
                </div>
                <div class="input-field col s12">
                    <textarea id="body" class="materialize-textarea body"></textarea>
                    <label for="body">Body</label>
                </div>
                <a class="waves-effect waves-light btn btn-large" id="req"><i class="material-icons right">send</i><strong>SEND REQUEST</strong></a>
            </div>
            <div class="col s6">
                <h4>Response
                </h4>
                <div class="input-field col s12">
                    <textarea id="responseH" class="materialize-textarea" disabled placeholder="headers"></textarea>
                </div>
                <div class="input-field col s12">
                    <textarea id="responseB" class="materialize-textarea" disabled placeholder="body"></textarea>
                </div>
            </div>
        </div>
        <footer class="page-footer blue">
            <div class="footer-copyright">
                <div class="leftpadding">
                    <span class="white-text">Powered by </span><a class="white-text" href="https://github.com/Dogfalo/materialize"><strong>Materialize</strong></a> | <a class="white-text" href="https://github.com/axios/axios"><strong>Axios</strong></a> | <a class="white-text" href="https://github.com/BrowserSync/browser-sync"><strong>Browser-sync</strong></a>
                </div>
            </div>
        </footer>
        <script>
            function parsingJson(value, func) {
                var returnedVal;
                try {
                    returnedVal = func === JSON.parse ? JSON.parse(value) : JSON.stringify(value, undefined, 4);
                } catch (e) {
                    returnedVal = value;
                }
                return returnedVal;
            }

            document.addEventListener('DOMContentLoaded', function () {
                var elems = document.querySelectorAll('select');
                var instances = M.FormSelect.init(elems/*, options*/);
            });

            document.getElementById("req").onclick = function () {
                document.getElementById("progressbar").classList.add('indeterminate');
                document.getElementById("progressbar").classList.remove('determinate');
                const methodElement = document.getElementById("methods");
                var method = methodElement.options[methodElement.selectedIndex].text;
                var baseURL = document.getElementById("baseurl").value;
                var url = document.getElementById("url").value;
                var headersElement = document.getElementById("headers");
                var bodyElement = document.getElementById("body");
                var responseElementH = document.getElementById("responseH");
                var responseElementB = document.getElementById("responseB");

                var data = parsingJson(bodyElement.value, JSON.parse);
                var headers = parsingJson(headersElement.value, JSON.parse);

                var axiosConfig = {method, url, baseURL, data, headers};
                console.log("REQUEST::", axiosConfig);
                axios(axiosConfig)
                        .then((response) => {
                            console.log("RESPONSE::", response);
                            responseElementH.value = parsingJson(response.headers, JSON.stringify);
                            M.textareaAutoResize(responseElementH);
                            responseElementB.value = parsingJson(response.data, JSON.stringify);
                            M.textareaAutoResize(responseElementB);
                            setTimeout(() => {
                                document.getElementById("progressbar").classList.add('determinate');
                                document.getElementById("progressbar").classList.remove('indeterminate');
                            }, 1000)
                        })
                        .catch((error) => {
                            M.toast({classes: "rounded card-panel red white-text text-darken-4", html: `<p>${error}</p>`})
                            console.error("ERROR::", error);
                            document.getElementById("progressbar").classList.add('determinate');
                            document.getElementById("progressbar").classList.remove('indeterminate');
                        });
            };
        </script>
    </body>
</html>
